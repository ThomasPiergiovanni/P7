
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no"
        />
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
        <title>GrandPyBot</title>

           
    </head>
    <body>

        <nav class="navbar navbar-expand-xs navbar-dark bg-dark">
        <div class="container">            
                <p class="navbar-brand">
                    Ask your question to Grandpy
                </p>
         </div>           
        </nav>

        <div class="container">
            <div class="row">
                <div class="col">
                    <form action="" method="post" novalidate>
                        <div class="form-group">

                                <input type="text" id="question" class="form-control" required>
                                <button type="button" id="ask_button" class="btn btn-primary">Ask</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
<!--         <div class="bg-light"> -->
            <div class="container">
                <div class="row">
                    <div class="col">


 
                                <ul class="col border border-dark" id="chat">
                                </ul>

                    </div>
                </div>
            </div>
<!--         </div> -->
<!--         <div class="bg-light">
            <div class="container">
                <div class="row">
                    <div class="col">
                        <iframe
                            class="embed-responsive embed-responsive-16by9"
                            id="grandpy_map"
                            width="200"
                            height="100"
                            frameborder="0" style="border:0"
                            src={{ gmap.url }} allowfullscreen>
                        </iframe>
                    </div>
                </div>
            </div>
        </div> -->

    <script type="text/javascript">

        let askButton = document.getElementById("ask_button");
        askButton.addEventListener('click', function(event) { 
            event.stopPropagation();
            event.preventDefault();

            let inputQuestion = document.getElementById("question");
            let userQuestion = document.getElementById("user_question");
            let chat = document.querySelector("#chat");
            let grandpyAnswerAddress = document.getElementById("grandpy_address");
            let grandpyAnswerWiki = document.getElementById("grandpy_information");
            let grandpyMap = document.getElementById("grandpy_map");
            let entry = { 
                question: inputQuestion.value
            };

            fetch(`${window.origin}/index/create-entry`, {
                method: "POST",
                credentials: "include",
                body: JSON.stringify(entry),
                cache: "no-cache",
                headers: new Headers({
                    "content-type": "application/json"
                })
            })
            .then(function(response) {
                if (response.status !== 200) {
                    console.log(`Looks like there was a problem. Status code: ${response.status}`);
                    return;
                }
                response.json().then(function(data) {
                console.log(data);

                let userPrefix = "@utilisateur: "
                let grandpyPrefix = "@grandpy: "

                let divUser = document.createElement("div");
                divUser.setAttribute("class", "mt-5");

                let divUserRow= document.createElement("div");
                divUserRow.setAttribute("class", "row");

                let divUserCol= document.createElement("div");
                divUserCol.setAttribute("class", "col-10");

                let divUserColRow1= document.createElement("div");
                divUserColRow1.setAttribute("class", "row");

                let divUserColRow2= document.createElement("div");
                divUserColRow2.setAttribute("class", "row");

                let spanUserPrefix = document.createElement("span");
                spanUserPrefix.textContent = userPrefix

                let spanQuestion = document.createElement("span");
                spanQuestion.textContent = inputQuestion.value

                divUser.append(divUserRow);
                divUserRow.append(divUserCol);
                divUserCol.append(divUserColRow1);
                divUserCol.append(divUserColRow2);
                divUserColRow1.append(spanUserPrefix);
                divUserColRow2.append(spanQuestion);
                chat.append(divUser);



                let divGrandPy = document.createElement("div");
                divGrandPy.setAttribute("class", "mt-3");

                let divGrandPyRow= document.createElement("div");
                divGrandPyRow.setAttribute("class", "row");

                let divGrandPyCol1= document.createElement("div");
                divGrandPyCol1.setAttribute("class", "col-2");

                let divGrandPyCol2= document.createElement("div");
                divGrandPyCol2.setAttribute("class", "col-10");

                let divGrandPyCol2Row1= document.createElement("div");
                divGrandPyCol2Row1.setAttribute("class", "row");

                let divGrandPyCol2Row2= document.createElement("div");
                divGrandPyCol2Row2.setAttribute("class", "row");

                let divGrandPyCol2Row3= document.createElement("div");
                divGrandPyCol2Row3.setAttribute("class", "row");

                let spanGrandpyPrefix = document.createElement("span");
                spanGrandpyPrefix.textContent = grandpyPrefix

                let spanGrandpyAddress = document.createElement("span");
                spanGrandpyAddress.textContent = data.address

                let spanGrandpyWiki = document.createElement("span");
                spanGrandpyWiki.textContent = data.information;

                divGrandPy.append(divGrandPyRow);
                divGrandPyRow.append(divGrandPyCol1);
                divGrandPyRow.append(divGrandPyCol2);
                divGrandPyCol2.append(divGrandPyCol2Row1);
                divGrandPyCol2.append(divGrandPyCol2Row2);
                divGrandPyCol2.append(divGrandPyCol2Row3);
                divGrandPyCol2Row1.append(spanGrandpyPrefix);
                divGrandPyCol2Row2.append(spanGrandpyAddress);
                divGrandPyCol2Row3.append(spanGrandpyWiki);
                chat.append(divGrandPy);



                grandpyMap.src = data.map;
                });
            })
            .catch(function(error) {
                console.log("Fetch error: " + error);
            });

        });

    </script>
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
  
    </body>
</html>